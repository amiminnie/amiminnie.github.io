<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>amiminnie</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="color-scheme" content="light dark">
    <meta name="theme-color" content="#111111">
    <link id="theme-style" rel="stylesheet" href="light.css">
    <link id="style" rel="stylesheet" href="style.css">
    <link rel="icon" href="assets/favicon.ico">
</head>

<body>

<div class="container">

    <!-- Header -->
    <header>
        <nav>
            <a href="" class="active">about</a>
            <a href="gallery.html">gallery</a>
            <a href="social.html">social</a>
            <button id="theme-toggle" class="theme-btn" title="Dark mode extensions may interfere with this!">
                <img id="theme-icon" src="images/moon-icon.png" alt="Toggle theme">
            </button>
        </nav>
    </header>

    <!-- Main -->
    <main>

        <section class="intro">
            <p class="prefix">am i</p>
            <h1>Minnie?</h1>
            <p class="subtitle">artist ⁘ developer </p>

            <div class="bio">
                <p>i sometimes make web-comics</p>
                <p>i'm working on a game, haven't thought of a name though</p>
                <p>i like <a href="https://geotastic.net" target="_blank" rel="noopener noreferrer">geotastic</a></p>
            </div>
        </section>

        
        <section class="guestbook">
            <h2>leave a comment!</h2>
  
            <form id="guestbook-form">
            <input type="text" id="name" placeholder="nickname (optional)">
            <textarea id="message" placeholder="what do you think?" required></textarea>
            <button type="submit">Send</button>
        </form>

  <div id="guestbook-entries">
    <p>loading what others have to say…</p>
  </div>
</section>
        
<section class="friends-list">
    <p class="prefixa">these are my</p>
    <h1>friends!</h1>
    <a class="friends-item" href="https://s4qc.github.io" target="_blank" rel="noopener noreferrer">
        <img src="images/s4qc.png" alt="S4qC">
        <div class="friends-text">
            <h2>S4qC</h2>
            <p>don't ask him why he stopped using linux</p>
        </div>
    </a>
    <a class="friends-item" href="#">
        <img src="images/coffee-fueled-student.jpeg" alt="Coffee feuled student">
        <div class="friends-text">
            <h2>coffee_fueled_student</h2>
            <p>hide the coffee</p>
        </div>
    </a>

</section>
        
    </main>

    <!-- Footer -->
    <footer>
        <p>minushadulwan@gmail.com</p>
        <p>comments are hosted by <a href="https://supabase.com" target="_blank" rel="noopener noreferrer">Supabase</a></p>
    </footer>

</div>
    
<script>
const themeLink = document.getElementById("theme-style");
const toggleBtn = document.getElementById("theme-toggle");
const themeIcon = document.getElementById("theme-icon");

const savedTheme = localStorage.getItem("theme");
const systemPrefersDark = window.matchMedia("(prefers-color-scheme: dark)").matches;

function setTheme(mode) {
    if (mode === "dark") {
        themeLink.href = "dark.css";
        document.documentElement.style.colorScheme = "dark";
        themeIcon.src = "images/sun-icon.png";
        themeIcon.alt = "Switch to light mode";
        localStorage.setItem("theme", "dark");
    } else {
        themeLink.href = "light.css";
        document.documentElement.style.colorScheme = "light";
        themeIcon.src = "images/moon-icon.png";
        themeIcon.alt = "Switch to dark mode";
        localStorage.setItem("theme", "light");
    }
}

// Initial load
if (savedTheme) {
    setTheme(savedTheme);
} else if (systemPrefersDark) {
    setTheme("dark");
} else {
    setTheme("light");
}

// Toggle click
toggleBtn.addEventListener("click", () => {
    themeIcon.style.transform = "scale(0)";
    setTimeout(() => {
        const current = localStorage.getItem("theme");
        setTheme(current === "dark" ? "light" : "dark");
        void themeIcon.offsetWidth; // force reflow
        themeIcon.style.transform = "scale(1)";
    }, 120);
});

    </script>
    
<script type="module">
import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm';

// -----------------------------
// Supabase config
// -----------------------------
const SUPABASE_URL = "https://miwcmqwhudshgetmrmhf.supabase.co";
const SUPABASE_KEY = "sb_publishable_stheDa15dO1UIajFAVSHmw_hKuIf4GZ";

const supabase = createClient(SUPABASE_URL, SUPABASE_KEY);

// Elements
const guestbookForm = document.getElementById("guestbook-form");
const guestbookEntries = document.getElementById("guestbook-entries");

// -----------------------------
// Load existing messages
// -----------------------------
async function loadMessages() {
  try {
    const { data, error } = await supabase
      .from("guestbook")
      .select("*")
      .order("created_at", { ascending: false });

    if (error) throw error;

    guestbookEntries.innerHTML = "";

    if (!data.length) {
      guestbookEntries.innerHTML = "<p>aww nothing :(</p>";
      return; 
    }

    data.forEach(msg => {
      const div = document.createElement("div");
      div.className = "guestbook-entry";

      div.innerHTML = `
        <div class="guestbook-entry-header" style="display: flex; justify-content: space-between; align-items: baseline;">
          <strong>${msg.name}</strong>
          <small style="color: var(--text-muted); font-size: 0.75rem;">
            ${new Date(msg.created_at).toLocaleDateString({
              day: "numeric",
              month: "short",
              year: "numeric"
            })} - ${new Date(msg.created_at).toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })}
          </small>
        </div>
        <p>${msg.message}</p>
      `;

      // If reply exists, add it under the message, slightly indented
      if (msg.reply) {
        const replyDiv = document.createElement("div");
        replyDiv.className = "guestbook-reply";
        replyDiv.style.marginLeft = "1.5rem"; // indent
        replyDiv.style.borderLeft = "2px solid var(--border)"; // optional visual
        replyDiv.style.paddingLeft = "0.5rem";
        replyDiv.style.marginTop = "0.25rem";
        replyDiv.innerHTML = `<strong> ↪ Minnie:</strong> <span>${msg.reply}</span>`;
        div.appendChild(replyDiv);
      }

      guestbookEntries.appendChild(div);
    });
  } catch (err) {
    guestbookEntries.innerHTML = `<p>something is wrong: ${err.message}</p>`;
    console.error(err);
  }
}

// -----------------------------
// Submit new message
// -----------------------------
guestbookForm.addEventListener("submit", async (e) => {
  e.preventDefault();
  let name = document.getElementById("name").value.trim(); // use let
  const message = document.getElementById("message").value.trim();
  if (!message) return; // message is required
  if (!name) name = "Anonymous"; // now works

  try {
    const { error } = await supabase
      .from("guestbook")  // your table
      .insert([{ name, message }]);

    if (error) throw error;

    guestbookForm.reset();
    loadMessages(); // refresh list
  } catch (err) {
    alert("Failed to send message: " + err.message);
    console.error(err);
  }
});

// -----------------------------
// Initial load
// -----------------------------
loadMessages();
</script>

</body>
</html>